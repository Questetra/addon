<?xml version="1.0" encoding="UTF-8"?><service-task-definition>

<label>Extract Value from Query String</label>
<label locale="ja">クエリ文字列 から Value 抽出</label>

<summary>Extracts the value of the specified parameter from the serialized query-string (e.g. "a=123&amp;b=456") and stores it as workflow data</summary>
<summary locale="ja">シリアライズされたクエリ文字列（例 "a=123&amp;b=456"）から、指定パラメータの値（value）を抽出し、ワークフローデータとして格納します</summary>

<help-page-url>https://support.questetra.com/addons/extractor-serialized-string/</help-page-url>
<help-page-url locale="ja">https://support.questetra.com/ja/addons/extractor-serialized-string/</help-page-url>

<last-modified>2018-10-18</last-modified>

<configs>
  <config name="conf_DataIdA" required="true" form-type="SELECT" select-data-type="STRING_TEXTFIELD|STRING_TEXTAREA">
    <label>A: Select STRING DATA for Query String</label>
    <label locale="ja">A: クエリ文字列（Serialized Data）が格納されている文字列型データを選択してください</label>
  </config>
  <config name="conf_ParamName" required="true" el-enabled="true" form-type="TEXTFIELD">
    <label>B: Set Name of Parameter (e.g. 'a' "a=123&amp;b=456")</label>
    <label locale="ja">B: パラメータ名をセットしてください (例 'a' "a=123&amp;b=456")</label>
  </config>
  <config name="conf_DataIdC" required="true" form-type="SELECT" select-data-type="STRING_TEXTFIELD|DECIMAL">
    <label>C: Select STRING/NUMERIC DATA for Extacted Value (update)</label>
    <label locale="ja">C: 抽出値（Value）が格納される文字列型or数値型データを選択してください (更新)</label>
  </config>
</configs>

<engine-type>1</engine-type>

<script><![CDATA[
// (c) 2018, Questetra, Inc. (the MIT License)

// About "serialize" or "Query String"
// - see https://api.jquery.com/serialize/


//////// START "main()" ////////
main();
function main(){ 

//// == Config Retrieving / 工程コンフィグの参照 ==
const dataIdA = configs.get( "conf_DataIdA" ) + "";
const dataIdC = configs.get( "conf_DataIdC" ) + "";
const paramName = configs.get( "conf_ParamName" ) + "";
// 'java.lang.String' (String Obj) to javascript primitive 'string'

//// == Data Retrieving / ワークフローデータの参照 ==
const queryString = engine.findDataByNumber( dataIdA ) + "";

//// == Calculating / 演算 ==
let paramValue = getParam(paramName, queryString);

//// == Data Updating / ワークフローデータへの代入 ==
if(paramValue === null){
  throw new Error( 'PARAMETER "' + paramName + '" is not found.' );
}
if( engine.findDataDefinitionByNumber( dataIdC ).matchDataType( "DECIMAL" ) ){
  var returnValue =  parseFloat( paramValue );
  engine.setDataByNumber( dataIdC, new java.math.BigDecimal(returnValue) );
}else{
  engine.setDataByNumber( dataIdC, paramValue );
}

} //////// END "main()" ////////


function getParam(name, querystr) {
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
  var results = regex.exec(querystr);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}

]]></script>


<icon>
iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADXUlEQVRYR61XUVLbMBDVmr+YmcIJ
mp6g9AR1/kBipukJmp6gcALgBNATFE7QdAaJT8wJSE5QbtB0Bpu/bOe5kisUx7JD9ZdY9j7t2933
RKLHklJ+EEKMiWjIzDtEtIfXmXlGRAtmfhBCTI0xP7p+lmIb9/f3h0mSnBDRWAixE9tvnwPMtCzL
4zzPF23vrAWQZdnOYDD4QkRHPQKHsQDkwhhztg5EIwAb/Nal2Ht5LoS4JKLZ4+PjzJ0O+7e3t/eY
GZRMhBBv/YCgqCzLUVM2VgBIKfeI6NY/NTPfJUlyen19nXeh4PDwMFsul6dE9N7bj2yMjDEz/xvP
AOAkaZr+dMGZ+bcQ4sgYc9klcLhHSjkhom8+iKIo3viZqAGEabfBsxBxXyDIqBAiJ6JXrmOMMe/c
d2oAUkqk7MRuwslbgx8cHKAd0Zbg96qt2i2t9y4oM58ZY07xuwLQkPrPbWlH8CRJvnvZyLXWo7bs
BHQsHBUVAKUUOP5kT39njMnaPubvd/uKotiN9byUElS4wrzSWk8cgF+u8IhoFKt2pRRmw7mX0t/G
mOiQQncwMzoMa6G13qUgnXOtdTVe25Yt2ClO07dTlFJow2pOLJfLjxSk81hrfRED8JLnQbF/JZ+X
LukPg9uhMzbGgJbo8mnAgAOAezdyuxSSi2BbC3UAXqOF696DuG1tbWHY/VVRpRS7h1rrqDpa/s+J
CDO/Wn0A2K6rY/YGgH6G4BARqr4qppcCqKuyDwUhl7HZ0USBEGK+cRFuCmClCDdtw00BrLShP4hQ
lb5StfXUCwDUXVcNIgSRUi6cXHadBZsACN6pxveKGEG7OygbxjX8omtFuJ1JzA0rpaADTuj+iZHt
7QfPNLTKcaBqNVNtc8SXY+hHWZZDqGejIYFSNfk3bwri5MOwRpzJCP+PGhL3gq9UMRDRoW83NJjc
Z4q7YkoHg0FNhQVx/L9MqZ96d4BGW+6bSLsRTuYsZlTcR221w1/WzmqdyV17MUnTFHeAlQsG7n7M
nD89Pc2dBYPCEdFrIkJAmNXQ1MyLosg6XUx8bjG1cC9w3dGVd08l4a5xNasccNPqJL9pml4wM05W
efvYQrqJaFoUxVHMqEYB+MHs2B4zM1JeyzFUjZlxC56Bnpubm2kMpHv+B4f7Zsut/FA0AAAAAElF
TkSuQmCC
</icon>

</service-task-definition>
